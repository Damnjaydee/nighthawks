<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Circle — Reserve</title>
  <meta name="robots" content="noindex,nofollow" />
  <meta name="theme-color" content="#0a0a0a" />
  <meta name="color-scheme" content="dark" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Config first (provides window.NH.*) -->
  <script src="./config.js"></script>

  <!-- Inject the Tock loader using your slug from config.js -->
  <script>
    (function loadTock(){
      const slug = (window.NH && window.NH.TOCK_SLUG) || "";
      if (!slug) { console.warn("Missing NH.TOCK_SLUG in /config.js"); return; }
      const s = document.createElement("script");
      s.defer = true; s.src = "https://widgets.exploretock.com/v1/loader.js";
      s.setAttribute("data-tock-slug", slug);
      document.head.appendChild(s);
    })();
  </script>

  <style>
    :root{--bg:#0a0a0a;--fg:#eaeaea;--muted:#a7a7a7;--line:#1f1f1f;--accent:#c9a227}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .wrap{max-width:960px;margin:0 auto;padding:28px 20px 56px}
    header{display:flex;justify-content:space-between;align-items:center;padding:14px 0 18px;border-bottom:1px solid var(--line)}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit}
    .mark{width:34px;height:34px;border-radius:999px;background:linear-gradient(145deg,#151515,#0d0d0d);border:1px solid #202020;display:grid;place-items:center}
    .mark::before{content:"\1F985";filter:grayscale(1);opacity:.85}
    .name{font-family:"DM Serif Display",serif;letter-spacing:.02em;font-size:18px}
    .pill{color:var(--muted);font-size:12px;letter-spacing:.08em;text-transform:uppercase}
    .hero{padding:52px 0 8px}
    .kicker{color:var(--muted);font-size:12px;letter-spacing:.16em;text-transform:uppercase}
    .title{font-family:"DM Serif Display",serif;font-weight:400;font-size:clamp(30px,6vw,58px);letter-spacing:.01em;margin:.35rem 0 0}
    .card{margin:34px 0 42px;border:1px solid var(--line);border-radius:18px;background:linear-gradient(180deg,#0b0b0b,#090909);box-shadow:0 1px 0 #1b1b1b inset}
    .card .in{padding:22px;display:grid;gap:18px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media(max-width:720px){.form-grid{grid-template-columns:1fr}}
    label{font-size:12px;color:var(--muted);letter-spacing:.06em;text-transform:uppercase}
    input,select{width:100%;padding:12px;border-radius:12px;background:#0f0f0f;color:var(--fg);border:1px solid #1b1b1b;outline:none}
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgb(201 162 39 /.14)}
    .row{display:grid;gap:6px}
    .actions{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 18px;border-radius:999px;background:#111;color:#fff;border:1px solid #222;font-weight:600;letter-spacing:.02em;cursor:pointer}
    .btn:hover{transform:translateY(-1px)}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .note{color:var(--muted);font-size:12px}
    .divider{height:1px;background:var(--line);margin:6px 0 0}
    .muted{color:var(--muted);font-size:13px}
    footer{margin:56px 0 20px;text-align:center;color:var(--muted);font-size:12px}
    a{color:var(--fg)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="brand" href="/"><span class="mark" aria-hidden="true"></span><span class="name">Nighthawks</span></a>
      <span class="pill">Private Members</span>
    </header>

    <section class="hero" aria-labelledby="hero-title">
      <p class="kicker">THE CIRCLE — DINNER 02</p>
      <h1 id="hero-title" class="title">Prepaid reservation</h1>
    </section>

    <section class="card" aria-labelledby="reserve">
      <div class="in">
        <h2 id="reserve" class="kicker">RSVP</h2>

        <form id="ic-form" autocomplete="on" novalidate>
          <!-- honeypot -->
          <input type="text" name="website" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px;opacity:0" aria-hidden="true">
          <div class="form-grid">
            <div class="row">
              <label for="ic-name">Full name</label>
              <input id="ic-name" name="name" placeholder="Your name" required />
            </div>
            <div class="row">
              <label for="ic-email">Email</label>
              <input id="ic-email" name="email" type="email" placeholder="you@example.com" required />
            </div>
            <div class="row">
              <label for="ic-plusone">Plus-one</label>
              <select id="ic-plusone" name="plusone" required>
                <option value="" disabled selected>Select</option>
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </div>
            <div class="row" style="grid-column:1/-1;">
              <label for="ic-diet">Dietary notes (optional)</label>
              <input id="ic-diet" name="diet" placeholder="Allergies, restrictions" />
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="ic-btn" type="submit">Reserve on Tock</button>
            <span class="note">Secure checkout opens in a modal. You won’t leave this page.</span>
          </div>
        </form>

        <div class="divider"></div>
        <p class="muted">Questions? Reply to your invite email or message your concierge. All sales final; transfers allowed within 72 hours if availability permits.</p>
      </div>
    </section>

    <!-- Hidden Tock trigger (offering id is set from config.js at runtime) -->
    <button id="ic-tock"
            data-tock-widget="search-single"
            style="position:absolute;left:-9999px;top:-9999px;width:1px;height:1px;overflow:hidden;"
            aria-hidden="true">Reserve</button>

    <noscript>
      <p><a href="https://www.exploretock.com/" target="_blank" rel="noopener">Reserve on Tock</a></p>
    </noscript>

    <footer>© <span id="ic-year"></span> Nighthawks Concierge</footer>
  </div>

  <script>
    (function IC(){
      const $ = (s,c=document)=>c.querySelector(s);

      // UTM capture
      function captureUTM(){
        const p = new URLSearchParams(location.search);
        const keep = ["utm_source","utm_medium","utm_campaign","utm_content","utm_term"];
        const data = {}; keep.forEach(k => { if (p.get(k)) data[k] = p.get(k); });
        if (Object.keys(data).length) localStorage.setItem("nh_utm", JSON.stringify({ ...data, ts: Date.now() }));
      }
      function getUTM(){ try{ return JSON.parse(localStorage.getItem("nh_utm")||"null"); }catch{ return null; } }
      function savePreview(payload){ localStorage.setItem("nh_ic_rsvp", JSON.stringify({ ...payload, ts: Date.now() })); }

      function init(){
        // Gate: require invite success before access
        try{
          const gate = JSON.parse(localStorage.getItem("nh_ic_gate")||"null");
          if (!gate || gate.ok !== true) { location.href = "invite.html"; return; }
        }catch{ location.href = "invite.html"; return; }

        const year = $("#ic-year"); if (year) year.textContent = new Date().getFullYear();
        captureUTM();

        const form = $("#ic-form");
        const btn  = $("#ic-btn");
        const tock = $("#ic-tock");

        // Apply offering id from config
        const oid = (window.NH && window.NH.TOCK_OFFERING_ID) || "";
        if (tock && oid) tock.setAttribute("data-offering-id", oid);

        form.addEventListener("submit", (e)=>{
          e.preventDefault();
          if (!form.checkValidity()) { form.reportValidity(); return; }
          if (form.website && form.website.value) return; // bot

          const data = {
            name: $("#ic-name").value.trim(),
            email: $("#ic-email").value.trim(),
            plus_one: $("#ic-plusone").value === "yes",
            diet: $("#ic-diet").value.trim(),
            utm: getUTM()
          };

          savePreview(data);
          if (window.dataLayer){
            window.dataLayer.push({
              event: "ic_rsvp_submit",
              plus_one: data.plus_one,
              email_hash: data.email.replace(/(.{3}).+(@.+)/,"$1***$2")
            });
          }

          btn.disabled = true; btn.textContent = "Opening…";
          if (tock){ tock.click(); setTimeout(()=>{ btn.disabled=false; btn.textContent="Reserve on Tock"; }, 3200); }
          else {
            const slug = (window.NH && window.NH.TOCK_SLUG) || "";
            location.href = slug ? `https://www.exploretock.com/${slug}` : "https://www.exploretock.com/";
          }
        });
      }

      document.addEventListener("DOMContentLoaded", init);
    })();
  </script>
</body>
</html>
